(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,21192,78654,e=>{"use strict";let r=e.i(64042).Row;e.s(["Row",0,r],21192);var t=e.i(31757),t=t;let a=t.default;e.s(["Col",0,a],78654)},64042,31757,e=>{"use strict";e.i(47167);var r=e.i(71645),t=e.i(43794),a=e.i(8206),s=e.i(42064),o=e.i(50073);let l=(0,r.createContext)({});var n=e.i(56570),i=function(e,r){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>r.indexOf(a)&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)0>r.indexOf(a[s])&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(t[a[s]]=e[a[s]]);return t};function c(e,t){let[s,o]=r.useState("string"==typeof e?e:"");return r.useEffect(()=>{(()=>{if("string"==typeof e&&o(e),"object"==typeof e)for(let r=0;r<a.responsiveArray.length;r++){let s=a.responsiveArray[r];if(!t||!t[s])continue;let l=e[s];if(void 0!==l)return void o(l)}})()},[JSON.stringify(e),t]),s}let d=r.forwardRef((e,d)=>{let u,m,f,{prefixCls:p,justify:h,align:g,className:y,style:x,children:j,gutter:b=0,wrap:v}=e,S=i(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:I,direction:w}=r.useContext(s.ConfigContext),C=(0,o.default)(!0,null),O=c(g,C),$=c(h,C),_=I("row",p),[A,E,T]=(0,n.useRowStyle)(_),k=(u=[void 0,void 0],m=Array.isArray(b)?b:[b,void 0],f=C||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0},m.forEach((e,r)=>{if("object"==typeof e&&null!==e)for(let t=0;t<a.responsiveArray.length;t++){let s=a.responsiveArray[t];if(f[s]&&void 0!==e[s]){u[r]=e[s];break}}else u[r]=e}),u),P=(0,t.default)(_,{[`${_}-no-wrap`]:!1===v,[`${_}-${$}`]:$,[`${_}-${O}`]:O,[`${_}-rtl`]:"rtl"===w},y,E,T),R={};if(null==k?void 0:k[0]){let e="number"==typeof k[0]?`${-(k[0]/2)}px`:`calc(${k[0]} / -2)`;R.marginLeft=e,R.marginRight=e}let[N,F]=k;R.rowGap=F;let B=r.useMemo(()=>({gutter:[N,F],wrap:v}),[N,F,v]);return A(r.createElement(l.Provider,{value:B},r.createElement("div",Object.assign({},S,{className:P,style:Object.assign(Object.assign({},R),x),ref:d}),j)))});e.s(["Row",0,d],64042);var u=function(e,r){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>r.indexOf(a)&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)0>r.indexOf(a[s])&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(t[a[s]]=e[a[s]]);return t};function m(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let f=["xs","sm","md","lg","xl","xxl"],p=r.forwardRef((e,a)=>{let{getPrefixCls:o,direction:i}=r.useContext(s.ConfigContext),{gutter:c,wrap:d}=r.useContext(l),{prefixCls:p,span:h,order:g,offset:y,push:x,pull:j,className:b,children:v,flex:S,style:I}=e,w=u(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),C=o("col",p),[O,$,_]=(0,n.useColStyle)(C),A={},E={};f.forEach(r=>{let t={},a=e[r];"number"==typeof a?t.span=a:"object"==typeof a&&(t=a||{}),delete w[r],E=Object.assign(Object.assign({},E),{[`${C}-${r}-${t.span}`]:void 0!==t.span,[`${C}-${r}-order-${t.order}`]:t.order||0===t.order,[`${C}-${r}-offset-${t.offset}`]:t.offset||0===t.offset,[`${C}-${r}-push-${t.push}`]:t.push||0===t.push,[`${C}-${r}-pull-${t.pull}`]:t.pull||0===t.pull,[`${C}-rtl`]:"rtl"===i}),t.flex&&(E[`${C}-${r}-flex`]=!0,A[`--${C}-${r}-flex`]=m(t.flex))});let T=(0,t.default)(C,{[`${C}-${h}`]:void 0!==h,[`${C}-order-${g}`]:g,[`${C}-offset-${y}`]:y,[`${C}-push-${x}`]:x,[`${C}-pull-${j}`]:j},b,E,$,_),k={};if(null==c?void 0:c[0]){let e="number"==typeof c[0]?`${c[0]/2}px`:`calc(${c[0]} / 2)`;k.paddingLeft=e,k.paddingRight=e}return S&&(k.flex=m(S),!1!==d||k.minWidth||(k.minWidth=0)),O(r.createElement("div",Object.assign({},w,{style:Object.assign(Object.assign(Object.assign({},k),I),A),className:T,ref:a}),v))});e.s(["default",0,p],31757)},99133,e=>{"use strict";var r=e.i(27494);e.s(["Select",()=>r.default])},72211,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(58962),s=e.i(932),o=e.i(64571);function l(e){let t,a,l,n=(0,s.c)(6);return n[0]!==e?({children:t,...a}=e,n[0]=e,n[1]=t,n[2]=a):(t=n[1],a=n[2]),n[3]!==t||n[4]!==a?(l=(0,r.jsx)(o.Button,{...a,children:t}),n[3]=t,n[4]=a,n[5]=l):l=n[5],l}var n=e.i(11451);function i(e){let t,a,o=(0,s.c)(4);return o[0]!==e?({...t}=e,o[0]=e,o[1]=t):t=o[1],o[2]!==t?(a=(0,r.jsx)(n.Input,{...t}),o[2]=t,o[3]=a):a=o[3],a}var c=e.i(91542),d=e.i(22315);let u=e=>{let t,a,o,n,i,u,y,x,j,b,v,S,I,w,C=(0,s.c)(25),{data:O,loading:$,currentPage:_,totalResults:A,pageSize:E,onTableChange:T,callback:k}=e;C[0]!==k?(t=async(e,r)=>{await k(e,r)},C[0]=k,C[1]=t):t=C[1];let P=t;C[2]===Symbol.for("react.memo_cache_sentinel")?(a={title:"ID",dataIndex:"id",key:"id"},o={title:"Estado",key:"status",render:m},n={title:"Nombres y Apellidos",key:"fullname",dataIndex:"fullname"},i={title:"DNI",dataIndex:"dni",key:"dni"},u={title:"Empresa",key:"empresa",render:f},y={title:"F. y H. Ingreso",render:p,key:"fecha_hora_ingreso"},C[2]=a,C[3]=o,C[4]=n,C[5]=i,C[6]=u,C[7]=y):(a=C[2],o=C[3],n=C[4],i=C[5],u=C[6],y=C[7]),C[8]!==P?(x={title:"F. y H. Salida",render:(e,t)=>t.h_salida?t.fecha_salida?t.fecha_salida+` ${t.h_salida}`:`0000-00-00 ${t.h_salida}`:(0,r.jsx)(l,{onClick:()=>{P({hora_salida:(0,d.default)().format("HH:mm:ss"),fecha_salida:(0,d.default)().format("YYYY-MM-DD")},t.id)},size:"small",style:{backgroundColor:"gray",color:"white"},children:"Marcar"}),key:"fecha_hora_salida"},C[8]=P,C[9]=x):x=C[9],C[10]===Symbol.for("react.memo_cache_sentinel")?(b={title:"A quien visita",dataIndex:"person_you_visit",key:"person_you_visit"},j={title:"Motivo",dataIndex:"motivo",key:"motivo"},C[10]=j,C[11]=b):(j=C[10],b=C[11]),C[12]!==x?(v=[a,o,n,i,u,y,x,b,j],C[12]=x,C[13]=v):v=C[13];let R=v;return C[14]!==_||C[15]!==E||C[16]!==A?(S={current:_,pageSize:E,total:A,showSizeChanger:!1,showTotal:g},C[14]=_,C[15]=E,C[16]=A,C[17]=S):S=C[17],C[18]===Symbol.for("react.memo_cache_sentinel")?(I={x:"max-content"},C[18]=I):I=C[18],C[19]!==R||C[20]!==O||C[21]!==$||C[22]!==T||C[23]!==S?(w=(0,r.jsx)(c.Table,{columns:R,dataSource:O,rowKey:h,loading:$,size:"small",pagination:S,scroll:I,onChange:T}),C[19]=R,C[20]=O,C[21]=$,C[22]=T,C[23]=S,C[24]=w):w=C[24],w};function m(e,r){return"3"==r.estado?"FINALIZADO":"2"==r.estado?"EN PROCESO":"PROGRAMADO"}function f(e,r){return r.empresa&&r.empresa.length>20?r.empresa.slice(0,20)+"...":r.empresa}function p(e,r){let t="";return r.fecha&&(t=`${r.fecha}`),r.h_inicio&&(t+=` ${r.h_inicio}`),t}function h(e){return`${e.id}`}function g(e){return`Total ${e} registros`}var y=e.i(20835),x=e.i(31795);let j=async(e,r,t)=>{try{let a=x.API_ENDPOINTS.VISITS.LIST.replace("{page}",e).replace("{page_size}",r).replace("{query}",t);return await y.api.get(a)}catch(e){throw e}},b=async e=>{try{return await y.api.post(x.API_ENDPOINTS.VISITS.CREATE,e)}catch(e){throw e}},v=async e=>{try{return await y.api.post(x.API_ENDPOINTS.VISITS.CREATE_MASIVE,e)}catch(e){throw e}},S=async(e,r)=>{try{return await y.api.patch(x.API_ENDPOINTS.VISITS.PATCH.replace("{pk}",r),e)}catch(e){throw e}},I=async e=>{try{return await y.api.get(x.API_ENDPOINTS.VISITS.SEARCH.replace("{query}",e))}catch(e){throw e}};var w=e.i(8613),C=e.i(82717),O=e.i(87789),$=e.i(12931),_=e.i(21192),A=e.i(78654),E=e.i(99133),T=e.i(74276),T=T,k=e.i(3240),P=e.i(28685),R=e.i(58652),N=e.i(28546),F=e.i(70158);let B=({isModalOpen:e,onCancel:s,onOk:l,loading:i,fetchVisitsData:u,currentPage:m})=>{let[f]=w.Form.useForm(),{message:p}=a.App.useApp(),{user:h}=(0,t.useContext)(R.AuthContext),[g,y]=(0,t.useState)(!1),[x,j]=(0,t.useState)(!1),[S,B]=(0,t.useState)([]),[D,M]=(0,t.useState)(""),[V,Y]=(0,t.useState)([]),q=(0,t.useCallback)(async e=>{try{let r=await N.collaboratorService.search(e);B(r.data)}catch(e){B([])}},[]);(0,t.useEffect)(()=>{e&&f.setFieldsValue({fecha_ingreso:(0,d.default)(),hora_ingreso:(0,d.default)(),motivo:"LABORAR"})},[e,f]);let H=async e=>{try{let r=await I(e);if(!r.success)return p.error(r.error||"Error al registrar la asistencia"),!1;if(g)return Y(e=>[r.data,...e]),!0;return j(!1),f.setFieldsValue({documento:e}),J(),!0}catch(e){return!1}},L=async()=>{f.resetFields(),Y([]),y(!1)},z=async e=>{try{let r=await v(e);if(!r.success)return void p.error(r.error);p.success(r.message),s(),L(),u(m)}catch(e){p.error(e.toString())}},K=async e=>{let r=await b(e);r.success?(p.success(r.message),s(),L(),u(m)):p.error(r.error)},W=async e=>{try{let r={...e,usuario:h.id,fecha_ingreso:e.fecha_ingreso?e.fecha_ingreso.format("YYYY-MM-DD"):null,hora_ingreso:e.hora_ingreso?e.hora_ingreso.format("HH:mm:ss"):null,trabajador:e.trabajador?.value};if(g){if(0===V.length)return void p.warning("No hay visitas en la lista");r.visits=V,z(r)}else K(r)}catch(e){p.error("Error al enviar los datos de asistencia")}},U=(0,t.useCallback)(async e=>{try{let r=V.findIndex(r=>r.dni==e);if(-1!=r)return void p.warning(`El documento ${e} ya esta en la lista`);if(await H(e))return void p.success(g?"Se agrego a la lista":"Valores encontrados");p.error("Ocurrio un error")}catch(e){p.error("Error al procesar el escaneo")}},[H]),G=async e=>{e.trim().length>3&&q(e)},J=async()=>{let{documento:e}=f.getFieldValue(),r=await I(e);if(!r.success)return void p.error(r.error);let t=r.data;f.setFieldsValue({firts_name:t.nombre,last_name:t.apellidos,document:t.documento_empresa,company:t.empresa})};return(0,r.jsxs)($.Modal,{open:e,title:"Registrar Visita",onCancel:s,onOk:()=>f.submit(),confirmLoading:i,okText:"Registrar",cancelText:"Cancelar",width:"80%",centered:!0,style:{maxWidth:900},children:[(0,r.jsxs)(w.Form,{form:f,layout:"vertical",size:"middle",onFinish:W,style:{padding:"10px"},children:[(0,r.jsxs)(_.Row,{children:[(0,r.jsx)(T.default,{checked:g,onChange:()=>y(!g),children:"Registro Masivo"}),(0,r.jsx)(o.Button,{icon:(0,r.jsx)(k.QrcodeOutlined,{}),onClick:()=>j(!0)})]}),!g&&(0,r.jsxs)(_.Row,{gutter:[12,12],align:"bottom",wrap:!0,children:[(0,r.jsx)(A.Col,{xs:24,sm:12,md:6,lg:6,children:(0,r.jsx)(w.Form.Item,{name:"documento",label:"Documento",rules:[{required:!0,message:"Por favor ingresa un documento"}],style:{marginBottom:0},children:(0,r.jsx)(n.Input,{placeholder:"Ingrese número de documento"})})}),(0,r.jsx)(A.Col,{xs:24,sm:12,md:6,lg:6,children:(0,r.jsx)(w.Form.Item,{name:"firts_name",label:"Nombre",rules:[{required:!0,message:"Ingrese el nombre"}],style:{marginBottom:0},children:(0,r.jsx)(n.Input,{placeholder:"Nombres del visitante"})})}),(0,r.jsx)(A.Col,{xs:24,sm:12,md:6,lg:6,children:(0,r.jsx)(w.Form.Item,{name:"last_name",label:"Apellidos",style:{marginBottom:0},children:(0,r.jsx)(n.Input,{placeholder:"Apellidos del visitante"})})}),(0,r.jsx)(A.Col,{xs:24,sm:12,md:6,lg:6,children:(0,r.jsx)(o.Button,{onClick:J,type:"primary",icon:(0,r.jsx)(P.SearchOutlined,{}),style:{marginTop:30},children:"Buscar"})})]}),g&&(0,r.jsx)(c.Table,{dataSource:V,columns:[{title:"Documento",dataIndex:"dni",key:"dni"},{title:"Nombre",dataIndex:"nombre",key:"nombre"},{title:"Apellidos",dataIndex:"apellidos",key:"apellidos"}],rowKey:e=>`${e.dni}`,size:"small",pagination:!1}),(0,r.jsx)(w.Form.Item,{name:"person_you_visit",label:"Trabajador",style:{marginBottom:0},rules:[{required:!0,message:"Seleccione una persona"}],children:(0,r.jsx)(E.Select,{showSearch:!0,filterOption:!1,placeholder:"Persona a quien visita",fieldNames:{label:"fullname",value:"id"},options:S,onSearch:e=>{G(e)},notFoundContent:D?"No se encontraron resultados":"Escriba para buscar"})}),(0,r.jsx)(w.Form.Item,{style:{marginBottom:0},name:"motivo",label:"Motivo (Opcional)",children:(0,r.jsx)(n.Input,{placeholder:"Ingrese motivo de la visita"})}),(0,r.jsxs)(_.Row,{gutter:[12,12],children:[(0,r.jsx)(A.Col,{xs:24,md:8,children:(0,r.jsx)(w.Form.Item,{name:"position",label:"Cargo",style:{marginBottom:0},children:(0,r.jsx)(n.Input,{placeholder:"Ej. Técnico, Supervisor..."})})}),(0,r.jsx)(A.Col,{xs:24,md:8,children:(0,r.jsx)(w.Form.Item,{style:{marginBottom:0},name:"fecha_ingreso",label:"Fecha de Ingreso",rules:[{required:!0,message:"Seleccione la fecha de ingreso"}],children:(0,r.jsx)(C.DatePicker,{style:{width:"100%"},format:"YYYY-MM-DD"})})}),(0,r.jsx)(A.Col,{xs:24,md:8,children:(0,r.jsx)(w.Form.Item,{style:{marginBottom:0},name:"hora_ingreso",label:"Hora de Ingreso",rules:[{required:!0,message:"Seleccione la hora de ingreso"}],children:(0,r.jsx)(O.TimePicker,{style:{width:"100%"},format:"HH:mm:ss"})})})]}),(0,r.jsxs)(_.Row,{gutter:[12,12],children:[(0,r.jsx)(A.Col,{xs:24,md:8,children:(0,r.jsx)(w.Form.Item,{style:{marginBottom:0},name:"document",label:"RUC/DNI/CE/PP",children:(0,r.jsx)(n.Input,{placeholder:"Número de documento"})})}),(0,r.jsx)(A.Col,{xs:24,md:12,children:(0,r.jsx)(w.Form.Item,{style:{marginBottom:0},name:"company",label:"Razón Social",children:(0,r.jsx)(n.Input,{placeholder:"Nombre de la empresa"})})}),(0,r.jsx)(A.Col,{xs:24,md:4,children:(0,r.jsx)(o.Button,{block:!0,icon:(0,r.jsx)(P.SearchOutlined,{}),style:{marginTop:30},type:"primary",children:"Buscar"})})]}),(0,r.jsx)(_.Row,{children:(0,r.jsx)(w.Form.Item,{style:{marginBottom:0,flex:1},name:"observation",label:"Obervaciones",children:(0,r.jsx)(n.Input.TextArea,{rows:2,placeholder:"Cantidad, Obs."})})})]}),(0,r.jsx)($.Modal,{title:"Escanear Código de Barras",open:x,onCancel:()=>{j(!1)},footer:null,width:500,centered:!0,children:(0,r.jsx)("div",{style:{width:"100%",height:350},children:(0,r.jsx)(F.default,{qrCodeContainerId:"qr-code-full-region",onScanSuccess:U,onScanError:e=>console.warn("Scan error:",e),isModalOpen:e})})})]})};function D(){let{message:e}=a.App.useApp(),[s,o]=(0,t.useState)([]),[n,c]=(0,t.useState)(1),[d,m]=(0,t.useState)(0),[f,p]=(0,t.useState)(!1),[h,g]=(0,t.useState)(!1),[y,x]=(0,t.useState)(""),[b,v]=(0,t.useState)(!1),I=(0,t.useRef)(null),w=async(e,r="")=>{p(!0);try{let t=await j(e,15,r);o(t.results),m(t.count)}catch(e){console.error("Error fetching visits data:",e),o([]),m(0)}finally{p(!1)}},C=(0,t.useCallback)(async e=>{let r=e.toLowerCase();if(""===r.trim())return void w(n);let t=s.filter(e=>{let t=e.fullname?String(e.fullname).toLowerCase():"",a=e.dni?String(e.dni):"";return t.includes(r)||a.includes(r)});0===t.length?w(n,e):o(t)},[s,w,n]);(0,t.useEffect)(()=>{w(n)},[n]);let O=async(r,t)=>{p(!0);let a=await S(r,t);a.success?(e.success(a.message),w(n)):e.error(a.error)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"space-between"},children:[(0,r.jsx)("h3",{children:"Listado Ingresos y Salidas"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"end",gap:8},children:[(0,r.jsx)(l,{onClick:()=>{g(!0)},children:"Agregar"}),(0,r.jsx)(i,{ref:I,placeholder:"Buscar",value:y,onChange:e=>{x(e.target.value),C(e.target.value)},onFocus:()=>v(!0),onBlur:()=>v(!1)})]})]}),(0,r.jsx)(u,{data:s,loading:f,currentPage:n,totalResults:d,pageSize:15,onTableChange:e=>{c(e.current)},callback:O}),(0,r.jsx)(B,{isModalOpen:h,onCancel:()=>{g(!1)},onOk:()=>{g(!1)},loading:f,fetchVisitsData:w,currentPage:n})]})}e.s(["default",()=>D],72211)}]);